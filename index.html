<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MickyChat - Painel</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Pequenos ajustes para botões de edição/exclusão */
    .funil-card {
      background: rgba(255, 255, 255, 0.07);
      border-radius: 12px;
      width: 260px;
      height: 120px;
      padding: 15px;
      color: white;
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: transform 0.2s ease;
    }

    .funil-nome {
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 8px;
      outline: none;
      user-select: text;
    }

    .funil-acoes {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    .btn-editar,
    .btn-excluir {
      background: #30cfd0;
      border: none;
      border-radius: 6px;
      padding: 5px 10px;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .btn-editar:hover,
    .btn-excluir:hover {
      background-color: #26bfbf;
    }

    .btn-excluir {
      background: #e55353;
      color: white;
    }

    .btn-excluir:hover {
      background-color: #bf4747;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- MENU LATERAL: Sempre fixo à esquerda -->
    <aside class="sidebar">
      <div class="logo">💠 <strong>MickyChat</strong></div>
      <nav>
        <ul>
          <li class="ativo" data-section="metricas">📊 Métricas</li>
          <li data-section="conexao">🔌 Conexão</li>
          <li data-section="funis">🧩 Funis</li>
          <li data-section="disparos">🚀 Disparos</li>
          <li data-section="suporte">💬 Suporte</li>
          <li data-section="extensao">🧷 Extensão Web</li>
          <li data-section="sair">🚪 Sair</li>
        </ul>
      </nav>
      <div class="whatsapp-help">
        <a href="https://wa.me/SEUNUMERO" target="_blank" rel="noopener">❓ Ajuda via WhatsApp</a>
      </div>
    </aside>

    <!-- CONTEÚDO PRINCIPAL -->
    <main class="conteudo">
      <!-- Seção Métricas -->
      <section id="metricas" class="secao ativa">
        <h2>📊 Métricas</h2>
        <p>Resumo do sistema e estatísticas futuras aparecerão aqui.</p>
      </section>

      <!-- Seção Conexão -->
      <section id="conexao" class="secao">
        <h2 class="conexao-titulo">Conexão</h2>
        <p class="conexao-subtitulo">Conecte e verifique sua conexão com o WhatsApp.</p>
        <div class="box-conexao">
          <div class="status-conexao">
            <strong>Status:</strong>
            <span id="status-indicador" class="desconectado">Desconectado</span>
          </div>
          <button class="botao-primario" onclick="mostrarNumero()">📱 Conecte um número</button>
          <button class="botao-destaque" onclick="gerarQRCode()">Conectar via QR-Code</button>
          <div id="mensagem-qrcode" class="mensagem-qrcode" style="display:none">
            ⏳ Gerando QR-Code… pode levar até 1 minuto.
          </div>
          <div id="qrcode-area" class="qrcode-area" style="display:none">
            <!-- Aqui aparecerá a imagem do QR-Code gerado -->
            <img src="qrcode-placeholder.png" alt="QR Code" />
          </div>
          <div class="alternativa-numero">
            <a href="#" onclick="abrirConexaoNumero()">Ou conectar com número</a>
          </div>
          <div id="conectar-por-numero" class="box-numero" style="display:none;">
            <label for="pais-select">Escolha seu país:</label>
            <select id="pais-select" onchange="atualizarCodigo()">
              <option value="+258" selected>🇲🇿 Moçambique (+258)</option>
              <option value="+55">🇧🇷 Brasil (+55)</option>
              <option value="+351">🇵🇹 Portugal (+351)</option>
              <option value="+244">🇦🇴 Angola (+244)</option>
              <!-- Adicione mais países conforme necessário -->
            </select>
            <div class="numero-input">
              <span id="codigo-pais">+258</span>
              <input type="text" id="numero-wpp" placeholder="Digite seu número" />
            </div>
            <button class="botao-destaque" onclick="conectarPorNumero()">Conectar via Número</button>
          </div>
        </div>
      </section>

      <!-- Seção Funis -->
      <section id="funis" class="secao">
        <div class="funil-header">
          <h1 class="funis-titulo">📈 Funis de Venda</h1>
          <p class="funis-descricao">
            Crie fluxos automatizados que iniciam assim que um cliente entrar em contacto com você.
          </p>
          <div class="funil-controle-topo">
            <span>Exibindo <span id="contador-funis">0</span> funis criados</span>
            <button class="criar-funil-btn" onclick="criarNovoFunil()">➕ Criar Funil</button>
          </div>
        </div>
        <div class="funil-grid" id="lista-funis">
          <!-- Funis serão inseridos dinamicamente aqui -->
        </div>
      </section>

      <!-- Seção Disparos -->
      <section id="disparos" class="secao">
        <h2>🚀 Disparos</h2>
        <p>Controle de conversas ativas, envio e pausa manual aparecerão aqui.</p>
      </section>

      <!-- Seção Suporte -->
      <section id="suporte" class="secao">
        <h2>💬 Suporte Automático</h2>
        <p>Escolha abaixo uma dúvida ou problema:</p>
        <div class="suporte-perguntas">
          <button onclick="respostaSuporte('pagamento')">💳 Como efectuar o pagamento?</button>
          <button onclick="respostaSuporte('teste')">🎁 Como funciona o teste grátis?</button>
          <button onclick="respostaSuporte('erro')">❌ Fiz pagamento e não desbloqueou</button>
          <button onclick="respostaSuporte('humano')">👨 Quero falar com um humano</button>
          <button onclick="respostaSuporte('sugestao')">📨 Quero dar sugestão ou reclamar</button>
        </div>
        <div id="resposta-suporte" class="suporte-resposta"></div>
      </section>

      <!-- Seção Extensão -->
      <section id="extensao" class="secao">
        <h2>🧷 Extensão Web - MChat Helper</h2>
        <p>Clique abaixo para baixar a extensão que facilita a automação no seu navegador.</p>
        <button onclick="baixarExtensao()">⬇️ Baixar Extensão (.zip)</button>
      </section>

      <!-- Seção Sair -->
      <section id="sair" class="secao">
        <h2>🚪 Sair</h2>
        <p>Você saiu do sistema com sucesso.</p>
        <button onclick="window.location.reload()">🔁 Recarregar</button>
      </section>
    </main>
  </div>

  <script>
    const listaFunis = document.getElementById('lista-funis');
    const contadorFunis = document.getElementById('contador-funis');

    let funis = [];

    function criarNovoFunil() {
      const nomeInicial = 'Funil sem título';
      const id = Date.now();
      funis.push({ id, nome: nomeInicial });
      atualizarListaFunis();
    }

    function atualizarListaFunis() {
      listaFunis.innerHTML = '';
      funis.forEach(funil => {
        const card = document.createElement('div');
        card.className = 'funil-card';
        card.dataset.id = funil.id;

        card.innerHTML = `
          <div class="funil-nome" contenteditable="false" spellcheck="false">${funil.nome}</div>
          <div class="funil-acoes">
            <button class="btn-editar" title="Editar nome">✏️</button>
            <button class="btn-excluir" title="Excluir funil">🗑️</button>
          </div>
        `;

        listaFunis.appendChild(card);

        const btnEditar = card.querySelector('.btn-editar');
        const btnExcluir = card.querySelector('.btn-excluir');
        const nomeDiv = card.querySelector('.funil-nome');

        btnEditar.onclick = () => {
          if (nomeDiv.isContentEditable) {
            nomeDiv.contentEditable = 'false';
            btnEditar.textContent = '✏️';
            funil.nome = nomeDiv.textContent.trim() || 'Funil sem título';
            atualizarContador();
          } else {
            nomeDiv.contentEditable = 'true';
            nomeDiv.focus();
            btnEditar.textContent = '💾';
          }
        };

        btnExcluir.onclick = () => {
          if (confirm('Deseja realmente excluir este funil?')) {
            funis = funis.filter(f => f.id !== funil.id);
            atualizarListaFunis();
            atualizarContador();
          }
        };

        nomeDiv.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            e.preventDefault();
            btnEditar.click();
          }
        });
      });
      atualizarContador();
    }

    function atualizarContador() {
      contadorFunis.textContent = funis.length;
    }

    // Inicializa com lista vazia
    atualizarListaFunis();
  </script>
</body>
</html>
